version: '3.8'
services:
  traefik:
    image: traefik:v2.5
    container_name: traefik
    command:
      - "--api.insecure=true"
      - "--providers.docker=true"
      - "--entryPoints.web.address=:100"
      - "--entryPoints.websecure.address=:443"
    ports:
      - "100:100"
      - "443:443"
    networks:
      - "test-cicd"
    volumes:
      - "/var/run/docker.sock:/var/run/docker.sock"
    labels:
      - "traefik.enable=true"
  backend:
    image: "duonganh203/be-cicd:latest"
    container_name: backend
    networks:
      - "test-cicd"
    ports:
      - "3000:3000"

  frontend:
    image: "duonganh203/fe-cicd:latest"
    container_name: frontend
    env_file:
      - .env
    environment:
      - APP_HELLO=${APP_HELLO}
    depends_on:
      - "backend"
    networks:
      - "test-cicd"
    ports:
      - "4000:80"
    labels:
      - "traefik.http.routers.app.rule=Host(`benkyo.systeme.io`)"
      - "traefik.http.services.app.loadbalancer.server.port=100"
 
networks:
  test-cicd:
    external: true
    name: test-cicd
